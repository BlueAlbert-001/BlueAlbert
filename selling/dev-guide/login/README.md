# 【通用】登录/用户信息

## 概述

业内按照业务流程，将小游戏的登录分为两种：

1. [静默登录](./#jing-mo-deng-lu)：获取openid
2. [授权登录](./#shou-quan-deng-lu)：获取openid，用户昵称、头像

{% hint style="info" %}
小游戏若没有展示用户头像昵称的需求，则可以只使用静默登录，来减少用户进入小游戏的交互，提高转化率
{% endhint %}

请根据自身游戏的业务需求阅读下方内容。

## 静默登录

### **1、**说明

用户打开小程序/小游戏时，默认进行静默登录，**该功能由sdk集成，无需开发**。

可通过[`.login`](get-user-info.md)接口直接获取用户openID。

### 2、兼容性问题（重要）

因为微信的[登录机制](https://developers.weixin.qq.com/minigame/dev/guide/open-ability/login.html)设定，无法在一次登录流程中多次获取openID，故：

1. 如果待接入天幕SDK的游戏本身**有获取openID的逻辑**，需要去除此部分逻辑，改用天幕的接口直接获取openID
2. 如果游戏原本**无获取openID的逻辑**，则直接引入SDK即可。
3. 如果曾接入过其他系统的SDK，需要去除其中获取openID的逻辑（阿拉丁的SDK无此逻辑，无需做处理）

## 授权登录

小游戏需用户昵称、头像等微信信息时，需要进行用户信息授权。该过程要求用户在打开小游戏时，进行一次按钮点击操作，如下图所示：

![](../../../.gitbook/assets/image%20%28144%29.png)

下方说明所涉及的相关api如下：

* [login](get-user-info.md)
* [updateUserInfo](update-userinfo.md)

### 1、为什么要授权

用户完成授权后，天幕平台会记录微信返回的头像、昵称等信息。

用户之后打开游戏时，开发者可以通过[`login`](get-user-info.md)接口从天幕平台获取头像、昵称，因此不再需要用户点击授权按钮。

### 2、兼容性问题（重要）

因为微信的[登录机制](https://developers.weixin.qq.com/minigame/dev/guide/open-ability/login.html)设定，无法在一次登录流程中多次获取openID，故：

1. 如果待接入天幕SDK的游戏本身**有获取openID的逻辑**，需要去除此部分逻辑，改用天幕的接口直接获取openID
2. 如果游戏原本**无获取openID的逻辑**，则直接引入SDK即可。
3. 如果曾接入过其他系统的SDK，需要去除其中获取openID的逻辑（阿拉丁的SDK无此逻辑，无需做处理）

### **3、何时触发授权**

用户信息授权需要用户进行点击行为，可能会对用户流失率产生影响，因此策略上应该减少大授权的次数。大授权次数过少，可能会导致用户更换微信昵称、头像后，在小游戏中无法更新。

这里有几种策略可供参考。

#### **1.初次进入时大授权**

仅在用户初次进入时进行大授权。 也就是在调用[`login`](get-user-info.md) 后，若返回值没有昵称、头像等信息，再使用 [`updateUserInfo`](update-userinfo.md) 向用户发起大授权。

若小游戏中需要使用用户头像、昵称，而不关心用户信息的更新（如用户换了昵称、头像），开发者可以采取该策略。

#### **2.定期大授权**

除了上述返回值没有昵称、头像的情况，一定要进行大授权以外，开发者可以自行确定大授权的频率，如每周一次、每月一次等等。

使用该方案，开发者可根据实际情况刷新用户信息，减少展示用户头像昵称时出现滞后的情况。

#### **3.不进行授权**

若小游戏中不展示用户昵称和头像，可以不进行大授权。 即使是初次进入的用户，也可以顺畅的直接开始游戏。

此外，需要头像、昵称的小程序/小游戏，可以通过以下方式规避大授权：

* 预置随机昵称
* 预置随机头像，如使用游戏角色图片作为用户头像
* 让用户自行设置昵称、头像、性别等信息

### 

